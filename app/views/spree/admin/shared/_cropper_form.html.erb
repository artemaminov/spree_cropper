<%= javascript_include_tag 'rcrop/rcrop.min' %>
<%= javascript_include_tag 'spree/backend/cropper' %>
<%= stylesheet_link_tag 'rcrop/rcrop.min' %>
<%= image_tag(main_app.url_for(resource.cropped_image.attachment), { id: 'source', style: 'max-width: 100%;', data: { devices: SpreeCropper::Config[:devices] } }) %>
<div id="targets"></div>
<div id="previews"></div>
<button type="button" id="values">Get values</button>
<%= f.fields_for :cropped_image, resource.cropped_image do |cropped_image_fields| %>
  <% if resource.cropped_image.croppers.empty? %>
    <% SpreeCropper::Config[:devices].count.times do |i| %>
      <%= cropped_image_fields.fields_for 'croppers', resource.cropped_image.croppers.build do |croppers_fields| %>
        <%# byebug %>
        <%= render partial: 'spree/admin/shared/cropper_fields', locals: { croppers_fields: croppers_fields, device: SpreeCropper::Config[:devices].keys[i].to_s } %>
      <% end %>
    <% end %>
  <% else %>
    <%= cropped_image_fields.fields_for :croppers do |croppers_fields| %>
      <%# byebug %>
      <%= render partial: 'spree/admin/shared/cropper_fields', locals: { croppers_fields: croppers_fields, device: croppers_fields.object.name } %>
    <% end %>
  <% end %>
<% end %>
<br/>
<span>Values:</span>
<span id="results"></span>
